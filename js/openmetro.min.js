/*! openmetro 2014-06-18 */
function loadMap(){var a='    id,"name","lat","lon","since","color","accessible","atmpoint","regionalrailways","nationalrailways","malpensatrain"\r\n    "m5_0","Bignami","45.526389","9.211944","2013-02-10","#a293bd","true","false","false","false","false"\r\n    "m5_1","Ponale","45.521944","9.209167","2013-02-10","#a293bd","true","false","false","false","false"\r\n    "m5_2","Bicocca","45.514722","9.205278","2013-02-10","#a293bd","true","false","false","false","false"\r\n    "m5_3",Ca\' Granda,"45.507222","9.201111","2013-02-10","#a293bd","true","false","false","false","false"\r\n    "m5_4","Istria","45.501667","9.197778","2013-02-10","#a293bd","true","false","false","false","false"\r\n    "m5_5","Marche","45.496389","9.195278","2013-02-10","#a293bd","true","false","false","false","false"\r\n    "m5_6","Zara","45.4926624575849","9.19270292116584","2013-02-10","#fbc02d","true","false","false","false","false"\r\n    "m5_7","Isola","45.487222","9.191111","2014-03-01","#a293bd","true","false","false","false","false"\r\n    "m5_8","Garibaldi FS","45.4842832621524","9.18889572165078","2014-03-01","#0c6510","true","true","true","true","true"',b=new CSV(a,{header:!0}).parse(),c={xCoord:960,yCoord:180,radius:18,pathM:965,pathV:130,coefficient:-50},d={x1:936,y1:180,x2:884,y2:180};displayLine(b,c,d)}function displayLine(a,b,c){for(var d=100,e=0;e<a.length;e++){if(currStation=a[e],("#a293bd"==currStation.color||e==a.length-1)&&createStationGUI(currStation,b),b.pathM=b.pathM-d,b.xCoord=b.xCoord-d,0==e)addConnection(0,c),console.log("building connection between "+a[e].name+" and "+a[e+1].name);else{if(e==a.length-1)return;console.log("building connection between "+a[e].name+" and "+a[e+1].name),addConnection(d,c)}"#a293bd"!=currStation.color&&e<a.length&&(b.pathM=b.pathM+d,b.xCoord=b.xCoord+d,createStationGUI(currStation,b),b.pathM=b.pathM-d,b.xCoord=b.xCoord-d)}}function createStationGUI(a,b){console.log("building "+a.name);var c=paper.text(50,50,a.name),d="M"+b.pathM+","+b.pathV+"V"+b.coefficient,e=paper.path(d),f=paper.circle(b.xCoord,b.yCoord,b.radius);c.attr({"font-size":"14px","font-family":"Arial",textpath:e}),f.attr({fill:"#fff",stroke:a.color,strokeWidth:14,id:a.id}),f.hover(function(){console.log("Clicked on: "+a.name),c.transform("t50,50r50t-50,0"),f.animate({r:30},700,mina.easeout)},function(){c.attr({textpath:d}),f.animate({r:18},700,mina.easein),c.transform("")}),f.click(function(){for(var b=document.getElementById("stationTable"),c=b.rows.length,d=0;c>d;d++)b.deleteRow(d),c--,d--;var e=document.querySelector("#stationData"),f=e.content.querySelectorAll("td");f[0].textContent="Stazione",f[1].textContent=a.name;var g=document.getElementsByTagName("tbody"),h=document.importNode(e.content,!0);g[0].appendChild(h),f[0].textContent="Inaugurata il",f[1].textContent=formatDate(a.since);var i=document.importNode(e.content,!0);g[0].appendChild(i),f[0].textContent="Servizi",f[1].innerHTML=a.accessible?"<img src='img/accessibility.png' alt='Stazione accessibile'><br>":"",f[1].innerHTML+=a.atmpoint?"<img src='img/atmpoint.png' alt='ATM Point: informazioni e punto vendita'><br>":"",f[1].innerHTML+=a.regionalrailways?"<img src='img/rrailways.png' alt='Linee ferroviarie regionali'><br>":"",f[1].innerHTML+=a.nationalrailways?"<img src='img/nrailways.png' alt='Interscambio con rete ferroviaria'><br>":"",f[1].innerHTML+=a.nationalrailways?"<img src='img/malpensatrain.png' alt='Treno per Aereoporto di Malpensa'>":"";var j=document.importNode(e.content,!0);g[0].appendChild(j),null!=document.getElementById("mapPicture")&&document.getElementById("mapPicture").parentNode.removeChild(document.getElementById("mapPicture"));var k="http://maps.googleapis.com/maps/api/staticmap?center="+a.lat+","+a.lon+"&zoom=15&size=600x300&maptype=roadmap",e=document.querySelector("#stationMap");e.content.querySelector("img").src=k;var l=document.importNode(e.content,!0);document.getElementById("pictureBox").appendChild(l)})}function addConnection(a,b){var c=null;a>0&&(b.x1=b.x1-a,b.x2=b.x2-a),c=paper.line(b.x1,b.y1,b.x2,b.y2),c.attr({fill:"#a293bd",stroke:"#a293bd",strokeWidth:16})}function formatDate(a){var b=a.split("-"),c=new Date(b[0],b[1]-1,b[2]);return("00"+c.getDate()).slice(-2)+"/"+("00"+(c.getMonth()+1)).slice(-2)+"/"+c.getFullYear()}var paper=Snap("#m5");window.onload=loadMap;